version: '3'

vars:
  BIN_DIR: bin
  APP_NAME: api
  VERSION: 1.0.0

tasks:
  default:
    desc: –°–±–æ—Ä–∫–∞ –¥–ª—è Linux –∏ macOS
    cmds:
      - task: build:all

  build:all:
    desc: –°–±–æ—Ä–∫–∞ –¥–ª—è –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º
    deps: [build:linux, build:darwin]
    cmds:
      - echo "–°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
      - ls -la {{.BIN_DIR}}/

  build:linux:
    desc: –°–±–æ—Ä–∫–∞ –¥–ª—è Linux
    cmds:
      - mkdir -p {{.BIN_DIR}}
      - GOOS=linux GOARCH=amd64 go build -o {{.BIN_DIR}}/{{.APP_NAME}}-linux-amd64 ./cmd/{{.APP_NAME}}
      - echo "üêß Linux —Å–±–æ—Ä–∫–∞ –≥–æ—Ç–æ–≤–∞"

  build:darwin:
    desc: –°–±–æ—Ä–∫–∞ –¥–ª—è macOS
    cmds:
      - mkdir -p {{.BIN_DIR}}
      - GOOS=darwin GOARCH=amd64 go build -o {{.BIN_DIR}}/{{.APP_NAME}}-darwin-amd64 ./cmd/{{.APP_NAME}}
      - echo "üçé macOS —Å–±–æ—Ä–∫–∞ –≥–æ—Ç–æ–≤–∞"

  clean:
    desc: –û—á–∏—Å—Ç–∫–∞ –±–∏–Ω–∞—Ä–Ω–∏–∫–æ–≤
    cmds:
      - rm -rf {{.BIN_DIR}}
      - echo "üóëÔ∏è –ü–∞–ø–∫–∞ {{.BIN_DIR}} –æ—á–∏—â–µ–Ω–∞"

  move:
    desc: –ü–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Ñ—Ä–æ–Ω—Ç–∞ –≤ web
    cmds:
      - mkdir ./web/build
      - cp -rf ../build/* ./web/build/
